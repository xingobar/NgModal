var NgModal = (function() {
	var k,
		f,
		c,
		d,
		g,
		b,
		e,
		l = function(a) {
			$('html,body').css({ height: '100%' });
			var b = $('body');
			0 == $(d).length &&
				(b.append(
					"<div id='ng_modal_outside'><div id='ng_modal_dialog'  class='ng-modal' role='dialog'><div class='ng-modal-content'><div class='ng-modal-body'><span>\u5f48\u7a97\u6e2c\u8a66</span></div> <div class='ng-modal-footer flex-end'><button type='button' name='yes'>\u78ba\u5b9a</button></div></div></div></div>"
				),
				c || (c = $('#ng_modal_dialog')),
				d || (d = $('#ng_modal_outside')),
				(k = a.hasOwnProperty('animate') ? a.animate : 'ng-rotate'),
				(f = k + '-end'),
				c.addClass(k));
			c.hasClass(f) && c.removeClass(f);
		},
		p = function(a) {
			if (a) {
				a.hasOwnProperty('backdrop') && d.css('background-color', a.backdrop);
				if (a.hasOwnProperty('shadow'))
					if ('boolean' === typeof a.shadow) a.shadow && c.addClass('ng-modal-shadow');
					else throw Error('params shadow is not boolean');
				if (a.hasOwnProperty('header') && a.header.hasOwnProperty('show'))
					if ('boolean' === typeof a.header.show)
						a.header.show &&
							($("<div class='ng-modal-header'><span>Header</span></div>").insertBefore('.ng-modal-body'),
							g || (g = $('.ng-modal-header')),
							a.header.hasOwnProperty('text') && g.find('span').text(a.header.text),
							a.header.hasOwnProperty('content') && (g.children().remove(), g.append(a.header.content)));
					else throw Error('params header.show is not boolean');
				a.hasOwnProperty('body') &&
					(b || (b = $('.ng-modal-body')),
					a.body.hasOwnProperty('text') && b.find('span').text(a.body.text),
					a.body.hasOwnProperty('content') && (b.children().remove(), b.append(a.body.content)));
				a.hasOwnProperty('yes') && a.yes.hasOwnProperty('text') && $("button[name='yes']").text(a.yes.text);
				a.hasOwnProperty('cancel') &&
					a.cancel.hasOwnProperty('text') &&
					$("button[name='cancel']").text(a.cancel.text);
				if (a.hasOwnProperty('time'))
					if ('number' === typeof a.time) m(a.time);
					else throw Error('params time is not integer');
				else m(5e3);
				if (a.hasOwnProperty('shadowClose'))
					if ('boolean' === typeof a.shadowClose) a.shadowClose && n();
					else throw Error('params shadowClose is not boolean');
				else n();
			}
		},
		q = function(a) {
			d || (d = $('#ng_modal_outside'));
			c || (c = $('#ng_modal_dialog'));
			g || (g = $('.ng-modal-header'));
			b || (b = $('.ng-modal-body'));
			e || (e = $('.ng-modal-footer'));
			var f = e.find('button[name="yes"]'),
				k = e.find('button[name="cancel"]');
			f &&
				f.click(function() {
					if (a.hasOwnProperty('close'))
						if ('function' === typeof a.close) h(a.close);
						else throw Error('params close must be function');
					else h();
				});
			k &&
				k.click(function() {
					if (a.hasOwnProperty('cancel'))
						if ('function' === typeof a.cancel) h(a.cancel);
						else throw Error('params cancel must be function');
					else h();
				});
		},
		m = function(a) {
			setTimeout(function() {
				h();
			}, a ? a : 5e3);
		},
		n = function() {
			$('#ng_modal_outside').click(function() {
				h();
			});
		},
		h = function(a) {
			a && a();
			c.addClass(f);
			d || (d = $('#ng_modal_outside'));
			setTimeout(function() {
				d.remove();
				$('html,body').removeAttr('style');
			}, 1100);
		};
	return {
		alert: function(a) {
			l(a);
			e || (e = $('.ng-modal-footer'));
			q(a);
			b || (b = $('.ng-modal-body'));
			p(a);
		},
		confirm: function(a) {
			l(a);
			e || (e = $('.ng-modal-footer'));
			b || (b = $('.ng-modal-body'));
			e.append("<button type='button' name='cancel'>\u53d6\u6d88</button>");
			b.attr('id', 'alert_modal_body');
			$('button[name="yes"]').addClass('ng-modal-btn-margin');
			q(a);
			p(a);
		},
		close: h
	};
})();
